{% extends "../sh/legacy.html" %}

{% block title %}Простейшие операции с git - {% endblock %}

{% block textcontent %}
	<style>
		pre{
			margin:0.5em;
			border:2px solid gray;
			padding:0.5em;
		}
		li{
			line-height:146%;
		}
	</style>
<p>
	Это - никоим образом не исчерпывающее руководство по использованию git.
	За фундаментальным учебником милости просим на <a href="https://git-scm.com/book/ru/v1">git-scm</a>,
	он даже почти полностью переведён на русский.
	А здесь описан типовой алгоритм добавления чего-нибудь.
</p>
<p>
	<b>
		Внимание!
		Для bitbucket схема немного другая.
		То, что написано здесь, ориентировано на студентов, проходящих практику на матфаке ВГУ.
	</b>
</p>
<h2>
	То, что всегда нужно сделать ровно один раз.
</h2>
<ol>
	<li>
		Зарегистрироваться на <a href="https://github.com/join">гитхабе</a>
	</li>
	<li>
		Перейти в гитхабовский репозиторий "ЧАС-ЕГЭ" и нажать кнопочку "Fork" справа вверху.
	</li>
</ol>
<h2>
	То, что нужно сделать один раз на каждой системе, с которой ведётся работа
</h2>
<p>
	<i>
		Примечание: для студентов, проходящих практику на загрузочных дисках (LiveCD), это нужно делать при каждом включении компьютера.
	</i>
</p>
<ol>
	<li>
		Открываем терминал (на LiveCD - чёрный квадратик на левой панели, там подсказка будет).
	</li>
	<li>
		Переходим в папку с "Час ЕГЭ" (для LiveCD):
		<pre>cd git/chas-ege</pre>
		<i>
			Подсказка: после ввода команды нажимайте Enter.
			Будьте внимательны, не путайте буквы.
		</i>
	</li>
	<li>
		Представляемся гиту:
		<pre>git config --global user.name "Василий Пупкин"</pre>
		<pre>git config --global user.email super1vasya@pochtarossii.ru</pre>
		<i>
			Если Вы ошиблись на этом этапе - не спешите стучать по резету, команды можно переделывать по нескольку раз.
		</i>
	</li>
	<li>
		<s>Красимся</s> <s>Краснеем</s> <s>Зеленеем</s> <s>Озеленяем</s>
		Раскрашиваем вывод гита в красивенькие красный и зелёный цвета (там, где надо):
		<pre>git config --global color.ui true</pre>
		<i>Здесь сложно ошибиться, но тоже можно делать несколько раз.</i>
	</li>
	<li>
		Добавляем свой форк на гитхабе в список удалённых репозиториев:
		<pre>git remote add myfork https://github.com/vasya/chas-ege.git</pre>
		где vasya - Ваш ник на гитхабе.
		<i>
			Удалённый - это от слова "далеко", а не от слова "удалить".
		</i>
	</li>
</ol>
<h2>
	Добавление в git сделанной задачи
</h2>
<ol>
	<li>
		Переключаемся на основную ветку (devel):
		<pre>git checkout devel</pre>
	</li>
	<li>
		Обновляем текущую ветку:
		<pre>git pull origin devel</pre>
	</li>
	<li>
		Бранчуемся (создаём новую ветку):
		<pre>git checkout -b newtask-777</pre>
		где 777 - это номер таска на гитхабе.
	</li>
	<li>
		Теперь вносим изменения.
		В случае задачи - это:
		<ul>
			<li>
				Создание файла где-то в директории zdn (обычно указывается, где).
				<ul>
					<li>
						Если задача имеет номер по <a href="http://mathege.ru/or/ege/Main.html">Обзаду</a>,
						то с помощью nautilus (это как виндовый проводник, шкафчик такой с ящичками на левой панели)
						переходим из домашней папки в git, потом в chas-ege, далее zdn, далее matege2016p,
						(сокращённо - идём в ~/git/chas-ege/zdn/matege2016p)
						а там уже выбрать номер задания по Обзаду.
						Номер задачи указывается как следующий, например, файл 12.js
					</li>
					<li>
						Если задача обзадовского номер не имеет, то в ~/git/chas-ege/zdn/egeok или в ~/git/chas-ege/zdn/mlegko
						находим папку, указанную в породившем issue того issue, по которому сделана задача.
						Если там ничего не указано - то нужно этот вопрос поднять, укажем.
						Номер задачи указывается, как правило, соответствующий номеру задачи на странице.
					</li>
				</ul>
			</li>
			<li>
				Теперь нужно создать или исправить файл main.js в той же папке.
				Как правило, понятно, как это сделать.
				Если Вы только что создали новую папку с необзадовскими заданиями, то следует написать его вот так:
<pre>
window.nomer=[
	12,
].iz();
</pre>
				где 12 - номер сделанного Вами задания.
				Это странно, но так потом легче дописывать.
			</li>
			<li>
				Наконец, если в issue была указана страница сайта ege-ok.ru или matematikalegko.ru,
				надо добавить нашу задачу в список автоинтеграции ~/git/chas-ege/lib/autointegr.js
				<br/>
				Берём адрес такой страницы, вырезаем кусок, начинающейся с двойной дроби // и отбрасываем дробь / на конце,
				если, конечно, она там есть.
				Ищем этот фрагмент в файле (Поиск - Найти).
				<ul>
					<li>
						Если он там есть, то акуратно дописываем адрес нашего шаблона (там понятно, как).
					</li>
					<li>
						Если его там нет, до в произвольное место списка (так мёржиться легче) дописываем по образцу:
						адрес в кавычках, двоеточие, массив из адресов заданий.
						Тут важно не ошибиться ;-)
						И внимательно следить за знаками препинания и пробелами!
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>
		В конце любого файла - обязательно пустая строка!
	</li>
	<li>
		Возвращаемся к нашему заскучавшему гиту.
		Смотрим, как там у нас дела обстоят в рабочей директории:
		<pre>git status</pre>
		Эта команда ничего не изменяет, только показывает, где мы и что там происходит.
		Если всё сделано правильно, то названия изменённых и добавленных файлов будут выделены красным.
		Зря мы, что ли, вывод красили?
		Смотрим, что перечислены только нужные файлы.
	</li>
	<li>
		Смотрим, что мы изменили в существующих файлах (новые не отобразятся):
		<pre>git diff</pre>
		Проматывать стрелочками вверх и вниз на клаве, выход, если что - клавиша Q в английской раскладке.
		Это надо в основном для того, чтоб не наделать чего-нибудь лишнего.
		Добавленное - зелёным и с плюсом, удалённой - красным и с минусом.
		Красные квадратики - это пробелы на концах строк, их надо убрать, открыв файлы, и повторить команду.
	</li>
	<li>
		Теперь снова:
		<pre>git status</pre>
	</li>
	<li>
		По одному добавляем командой
		<pre>git add имя/файла</pre>
		все нужные файлы.
		А можно и одним махом:
		<pre>git add .</pre>
	</li>
	<li>
		Снова
		<pre>git status</pre>
		Нужные файлы должны быть зелёными.
	</li>
	<li>
		Теперь коммит, например:
		<pre>git commit -m "Сделана задача №77, обзад №12345, matege2016p/B11/77.js"</pre>
		Если ошиблись в сообщении коммита и заметили это сразу, то можно легко исправить:
		<pre>git commit -m "Сделана задача №78, обзад №12345, matege2016p/B11/78.js" --amend</pre>
	</li>
	<li>
		Спокойно, осталось немного.
		Запушимся:
		<pre>git push myfork newtask-777:newtask-777</pre>
		где newtask-777 - имя Вашей ветки.
	</li>
	<li>
		Попросит ввести имя пользователя (не e-mail, а имя пользователя на гитхабе).
		Потом пароль.
		Это неспроста!
		Вводим имя пользователя, нажимаем Enter.
		Кажется, что пароль не вводится.
		Линукс вообще суров, даже звёздочек не показывает.
		После ввода пароля тоже нажимаем Enter.
		Если ошиблись при вводе логина и/или пароля, можно нажать стрелочку вверх на клавиаутре - появится предыдущая команда.
		Enter - и вуаля!
	</li>
	<li>
		Идём в свою репу на гитхабе
		(адрес наподобие http://github.com/vasya/chas-ege/, где vasya - Ваш ник на гитхабе),
		там должна быть зелёная кнопка "Compare &amp; pull request".
		Жмём её, дальше параметры по умолчанию.
	</li>
	<li>
		Жмём зелёную кнопку внизу, подтверждая создание пуллреквеста.
	</li>
</ol>
<h3>
	Понятно, что если не добавляется задача, а только изменяется оная или добавляется вообще другой кусок кода,
	то размещать её в zdn и в lib/autointegr.js нет смысла.
	А бранчевание, добавление файлов в гит  т. д.  - примерно такое же.
</h3>
<p>
	Внимание! Каждая новая задача - это по сути однокоммитная ветка.
	Поэтому, пока пуллреквест ожидает одобрения, после переключения на ветку devel этой задачи у Вас в репозитории не будет.
	Не пугайтесь!
</p>
<h2>
	Ребейз ветки
</h2>
<p>
	Ребейз (rebase) - это такая замечательная операция, которая позволяет применить коммиты к другому исходному состоянию.
	Подробнее про неё можно прочесть <a href="https://git-scm.com/book/ru/v1/Ветвление-в-Git-Перемещение">в этом разделе git-scm</a>.
	Смысла переписывать учебник не вижу.
	Нам она нужна на случай, если ветка devel на гитхабе убежала вперёд, чтобы не засорять историю паутиной.
	А ещё она очень полезна, когда несколько изменений свалены в одну ветку, а их хочется разнести по разным.
	Или объединить коммиты.
</p>
<ol>
	<li>
		Проверяем и запоминаем, на какой ветке мы находимся:
		<pre>git status</pre>
		Допустим, вывод был таким:
<pre>
# On branch newtask-123
nothing to commit (working directory clean)
</pre>
		Вот название newtask-123 надо запомнить.
	</li>
	<li>
		Переключаемся на ветку (состояние) devel:
		<pre>git checkout devel</pre>
		Обратите внимание: флага -b здесь нет.
	</li>
	<li>
		Теперь обновляем devel из основного репозитория уже знакомой командой:
		<pre>git pull origin devel</pre>
	</li>
	<li>
		Переключаемся обратно на нашу ветку:
		<pre>git checkout newtask-123</pre>
		Общее правило такое: если мы создаём новую ветку, то -b есть, а если прыгаем на существующую - то нет.
	</li>
	<li>
		Теперь создаём новую ветку, которую будем ребейзить.
		Новую - чтобы потом в случае чего вернуться на старую.
		<pre>git checkout -b newtask-123a</pre>
		Название можно выбрать относительно произвольное, лишь бы было понятно.
	</li>
	<li>
		Собственно ребейз:
		<pre>git rebase -i devel</pre>
		Это означает: "перенести текущую ветку так, как будто мы начали работу с новым вариантом devel".
		Откроется окошко текстового редактора.
		Там можно подправить, что переносить, а что нет (что не переносить - просто удалить).
		Можно переименовать коммит, написав вместо pick слово reword.
		Сохранить - Ctrl+O, выйти - Ctrl+X.
		Обычно достаточно просто выйти.
		<br/>
		Прелесть гита в том, что даже если мы удалим, изменим или отредактируем коммиты в ветке newtask-123a,
		то состояние ветки newtask-123 не изменится, и на него всегда можно будет вернуться.
		Просмотреть список всех доступных веток можно командой
		<pre>git branch</pre>
	</li>
	<li>
		Всё, можно пушить ветку по инструкции выше.
	</li>
</ol>

{% endblock %}
